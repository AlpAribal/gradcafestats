submissions <- enc2utf8(submissions)
Encoding(submissions) <- "unknown"
dbWriteTable(conn=con, name="submissions", value=as.data.frame(submissions), append=TRUE, row.names=FALSE)
#
# IF MIN(SUBID) <= DB.MAX(SUBID) OR RESLTS EMPTY
#   DB.SEND(FILTERED_RESLTS)
# ELSE
#   DB.SEND(RESLTS)
#   PageNo = PageNo + 1
if(pageNo > numPages){
break;
}
}
}
View(maxDB)
View(submissions)
View(submissions)
submissions['submissionId' > maxDB,]
submissions[submissions[,'submissionId'] > maxDB,]
nrow(submissions[submissions[,'submissionId'] > maxDB,])
setwd("C:\\Users\\User.DESKTOP-KRQQ533\\Desktop\\GradCafe\\")
require(RMySQL)
require(data.table)
require(RCurl)
require(stringr)
source("getSubmissions.R")
# YapÄ± ÅŸu ÅŸekilde olacak:
# Database'den son submissionId'yi al
# BÃ¼tÃ¼n alfanumerik karakterler iÃ§in http://thegradcafe.com/survey/index.php?q=a*&p=5000 sorgu at
# Cevapta son submission'dan kÃ¼Ã§Ã¼k bir Id ÅŸey varsa sonraki karaktere geÃ§
#chars <- c('a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v',
#           'w','x','y','z','1','2','3','4','5','6','7','8','9','0')
#chars <- c('a','c','d','e','f','g','h','i','l','m','n','o','s','t','u')
con <- dbConnect(RMySQL::MySQL(), dbname = "mydb", user="rUpdater", password="rUpdate")
oneChar = ''
numPages = -1
for(oneChar in chars){
#pageURL <- "http://thegradcafe.com/survey/index.php"
pageNo = 1
repeat {
# Construct the new page URL and log it
#pageURL <- paste0("http://thegradcafe.com/survey/index.php?q=", oneChar, "*&p=", pageNo, "&pp=250")
pageURL <- paste0('http://thegradcafe.com/survey/index.php?q=%28a*%7Cb*%7Cc*%7Cd*%7Ce*%7Cf*%7Cg*%7Ch*%7Ci*%7Cj*%7Ck*%7Cl*%7Cm*%7Cn*%7Co*%7Cp*%7Cq*%7Cr*%7Cs*%7Ct*%7Cu*%7Cv*%7Cw*%7Cx*%7Cy*%7Cz*%7C1*%7C2*%7C3*%7C4*%7C5*%7C6*%7C7*%7C8*%7C9*%7C0*%7C%28*%7C%29*%7C_*%29&t=a&o=&pp=250&p=',pageNo)
cat(paste0('Query: ', 'HEPSÄ°', ' Page:No ', pageNo, '/', numPages,' @', Sys.time()))
# Download the page
sourceCode <- getURL(pageURL)
print(paste0('Download complete.', ' @', Sys.time()))
pattern <- 'Showing <strong>\\d* results<\\/strong> over (\\d*) pages'
numPages <- as.numeric(str_match(sourceCode, pattern)[,-1])
if(is.na(numPages)){
print('numPages NA')
break
}
# Extract the submissions from (trimmed) source code
startStop <- str_locate(sourceCode, c('<tr class','</table>'))
sourceCode <- str_sub(sourceCode, startStop[1,1], startStop[2,2])
submissions <- getSubmissions(sourceCode)
query <- paste('SELECT MAX(submissionId) FROM submissions')
# paste(submissions[, "submissionId"], collapse = ','),
maxDB <- dbGetQuery(con, query)
cat(paste0('Last submitId is:', maxDB))
submissions <- submissions[submissions[,'submissionId'] > maxDB,]
print(paste0('There are ', nrow(submissions), ' new submissions in page ', pageNo))
pageNo <- pageNo + 1
if(nrow(submissions) < 1) {
next
}
# Encoding sometimes gives errors
Encoding(submissions) <- "unknown"
submissions <- enc2utf8(submissions)
Encoding(submissions) <- "unknown"
dbWriteTable(conn=con, name="submissions", value=as.data.frame(submissions), append=TRUE, row.names=FALSE)
#
# IF MIN(SUBID) <= DB.MAX(SUBID) OR RESLTS EMPTY
#   DB.SEND(FILTERED_RESLTS)
# ELSE
#   DB.SEND(RESLTS)
#   PageNo = PageNo + 1
if(pageNo > numPages){
break;
}
}
}
setwd("C:\\Users\\User.DESKTOP-KRQQ533\\Desktop\\GradCafe\\")
require(RMySQL)
require(data.table)
require(RCurl)
require(stringr)
source("getSubmissions.R")
#chars <- c('a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v',
#           'w','x','y','z','1','2','3','4','5','6','7','8','9','0')
con <- dbConnect(RMySQL::MySQL(), dbname = "mydb", user="rUpdater", password="rUpdate")
numPages = -1
#pageURL <- "http://thegradcafe.com/survey/index.php"
pageNo = 1
repeat {
# Construct the new page URL and log it
#pageURL <- paste0("http://thegradcafe.com/survey/index.php?q=", oneChar, "*&p=", pageNo, "&pp=250")
pageURL <- paste0('http://thegradcafe.com/survey/index.php?q=%28a*%7Cb*%7Cc*%7Cd*%7Ce*%7Cf*%7Cg*%7Ch*%7Ci*%7Cj*%7Ck*%7Cl*%7Cm*%7Cn*%7Co*%7Cp*%7Cq*%7Cr*%7Cs*%7Ct*%7Cu*%7Cv*%7Cw*%7Cx*%7Cy*%7Cz*%7C1*%7C2*%7C3*%7C4*%7C5*%7C6*%7C7*%7C8*%7C9*%7C0*%7C%28*%7C%29*%7C_*%29&t=a&o=&pp=250&p=',pageNo)
cat(paste0('Query: ', 'HEPSÄ°', ' Page:No ', pageNo, '/', numPages,' @', Sys.time()))
# Download the page
sourceCode <- getURL(pageURL)
print(paste0('Download complete.', ' @', Sys.time()))
pattern <- 'Showing <strong>\\d* results<\\/strong> over (\\d*) pages'
numPages <- as.numeric(str_match(sourceCode, pattern)[,-1])
if(is.na(numPages)){
print('numPages NA')
break
}
# Extract the submissions from (trimmed) source code
startStop <- str_locate(sourceCode, c('<tr class','</table>'))
sourceCode <- str_sub(sourceCode, startStop[1,1], startStop[2,2])
submissions <- getSubmissions(sourceCode)
query <- paste('SELECT MAX(submissionId) FROM submissions')
# paste(submissions[, "submissionId"], collapse = ','),
maxDB <- dbGetQuery(con, query)
cat(paste0('Last submitId is:', maxDB))
submissions <- submissions[submissions[,'submissionId'] > maxDB,]
print(paste0('There are ', nrow(submissions), ' new submissions in page ', pageNo))
pageNo <- pageNo + 1
if(nrow(submissions) < 1) {
break
}
# Encoding sometimes gives errors
Encoding(submissions) <- "unknown"
submissions <- enc2utf8(submissions)
Encoding(submissions) <- "unknown"
dbWriteTable(conn=con, name="submissions", value=as.data.frame(submissions), append=TRUE, row.names=FALSE)
if(pageNo > numPages){
break;
}
}
?dbGetQuery
setwd("C:\\Users\\User.DESKTOP-KRQQ533\\Desktop\\GradCafe\\")
require(RMySQL)
require(data.table)
require(RCurl)
require(stringr)
source("getSubmissions.R")
#chars <- c('a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v',
#           'w','x','y','z','1','2','3','4','5','6','7','8','9','0')
con <- dbConnect(RMySQL::MySQL(), dbname = "mydb", user="rUpdater", password="rUpdate")
numPages = -1
#pageURL <- "http://thegradcafe.com/survey/index.php"
pageNo = 1
repeat {
# Construct the new page URL and log it
#pageURL <- paste0("http://thegradcafe.com/survey/index.php?q=", oneChar, "*&p=", pageNo, "&pp=250")
pageURL <- paste0('http://thegradcafe.com/survey/index.php?q=%28a*%7Cb*%7Cc*%7Cd*%7Ce*%7Cf*%7Cg*%7Ch*%7Ci*%7Cj*%7Ck*%7Cl*%7Cm*%7Cn*%7Co*%7Cp*%7Cq*%7Cr*%7Cs*%7Ct*%7Cu*%7Cv*%7Cw*%7Cx*%7Cy*%7Cz*%7C1*%7C2*%7C3*%7C4*%7C5*%7C6*%7C7*%7C8*%7C9*%7C0*%7C%28*%7C%29*%7C_*%29&t=a&o=&pp=250&p=',pageNo)
cat(paste0('Query: ', 'HEPSÄ°', ' Page:No ', pageNo, '/', numPages,' @', Sys.time()))
# Download the page
sourceCode <- getURL(pageURL)
print(paste0('Download complete.', ' @', Sys.time()))
pattern <- 'Showing <strong>\\d* results<\\/strong> over (\\d*) pages'
numPages <- as.numeric(str_match(sourceCode, pattern)[,-1])
if(is.na(numPages)){
print('numPages NA')
break
}
# Extract the submissions from (trimmed) source code
startStop <- str_locate(sourceCode, c('<tr class','</table>'))
sourceCode <- str_sub(sourceCode, startStop[1,1], startStop[2,2])
submissions <- getSubmissions(sourceCode)
query <- paste('SELECT MAX(submissionId) FROM submissions')
# paste(submissions[, "submissionId"], collapse = ','),
maxDB <- dbGetQuery(conn=con, statement=query)
cat(paste0('Last submitId is:', maxDB))
submissions <- submissions[submissions[,'submissionId'] > maxDB,]
print(paste0('There are ', nrow(submissions), ' new submissions in page ', pageNo))
pageNo <- pageNo + 1
if(nrow(submissions) < 1) {
break
}
# Encoding sometimes gives errors
Encoding(submissions) <- "unknown"
submissions <- enc2utf8(submissions)
Encoding(submissions) <- "unknown"
dbWriteTable(conn=con, name="submissions", value=as.data.frame(submissions), append=TRUE, row.names=FALSE)
if(pageNo > numPages){
break;
}
}
dbListConnections( dbDriver( drv = "MySQL"))
lapply( dbListConnections( dbDriver( drv = "MySQL")), dbDisconnect)
setwd("C:\\Users\\User.DESKTOP-KRQQ533\\Desktop\\GradCafe\\")
require(RMySQL)
require(data.table)
require(RCurl)
require(stringr)
source("getSubmissions.R")
#chars <- c('a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v',
#           'w','x','y','z','1','2','3','4','5','6','7','8','9','0')
con <- dbConnect(RMySQL::MySQL(), dbname = "mydb", user="rUpdater", password="rUpdate")
numPages = -1
#pageURL <- "http://thegradcafe.com/survey/index.php"
pageNo = 1
repeat {
# Construct the new page URL and log it
#pageURL <- paste0("http://thegradcafe.com/survey/index.php?q=", oneChar, "*&p=", pageNo, "&pp=250")
pageURL <- paste0('http://thegradcafe.com/survey/index.php?q=%28a*%7Cb*%7Cc*%7Cd*%7Ce*%7Cf*%7Cg*%7Ch*%7Ci*%7Cj*%7Ck*%7Cl*%7Cm*%7Cn*%7Co*%7Cp*%7Cq*%7Cr*%7Cs*%7Ct*%7Cu*%7Cv*%7Cw*%7Cx*%7Cy*%7Cz*%7C1*%7C2*%7C3*%7C4*%7C5*%7C6*%7C7*%7C8*%7C9*%7C0*%7C%28*%7C%29*%7C_*%29&t=a&o=&pp=250&p=',pageNo)
cat(paste0('Query: ', 'HEPSÄ°', ' Page:No ', pageNo, '/', numPages,' @', Sys.time()))
# Download the page
sourceCode <- getURL(pageURL)
print(paste0('Download complete.', ' @', Sys.time()))
pattern <- 'Showing <strong>\\d* results<\\/strong> over (\\d*) pages'
numPages <- as.numeric(str_match(sourceCode, pattern)[,-1])
if(is.na(numPages)){
print('numPages NA')
break
}
# Extract the submissions from (trimmed) source code
startStop <- str_locate(sourceCode, c('<tr class','</table>'))
sourceCode <- str_sub(sourceCode, startStop[1,1], startStop[2,2])
submissions <- getSubmissions(sourceCode)
query <- paste('SELECT MAX(submissionId) FROM submissions')
# paste(submissions[, "submissionId"], collapse = ','),
maxDB <- dbGetQuery(conn=con, statement=query)
cat(paste0('Last submitId is:', maxDB))
submissions <- submissions[submissions[,'submissionId'] > maxDB,]
print(paste0('There are ', nrow(submissions), ' new submissions in page ', pageNo))
pageNo <- pageNo + 1
if(nrow(submissions) < 1) {
break
}
# Encoding sometimes gives errors
Encoding(submissions) <- "unknown"
submissions <- enc2utf8(submissions)
Encoding(submissions) <- "unknown"
dbWriteTable(conn=con, name="submissions", value=as.data.frame(submissions), append=TRUE, row.names=FALSE)
if(pageNo > numPages){
break;
}
}
lapply( dbListConnections( dbDriver( drv = "MySQL")), dbDisconnect)
submissions[,'submissionId'] = c(545999,545998,545340,545339)
View(submissions)
setwd("C:\\Users\\User.DESKTOP-KRQQ533\\Desktop\\GradCafe\\")
require(RMySQL)
require(data.table)
require(RCurl)
require(stringr)
source("getSubmissions.R")
#chars <- c('a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v',
#           'w','x','y','z','1','2','3','4','5','6','7','8','9','0')
con <- dbConnect(RMySQL::MySQL(), dbname = "mydb", user="rUpdater", password="rUpdate")
numPages = -1
#pageURL <- "http://thegradcafe.com/survey/index.php"
pageNo = 1
repeat {
# Construct the new page URL and log it
#pageURL <- paste0("http://thegradcafe.com/survey/index.php?q=", oneChar, "*&p=", pageNo, "&pp=250")
pageURL <- paste0('http://thegradcafe.com/survey/index.php?q=%28a*%7Cb*%7Cc*%7Cd*%7Ce*%7Cf*%7Cg*%7Ch*%7Ci*%7Cj*%7Ck*%7Cl*%7Cm*%7Cn*%7Co*%7Cp*%7Cq*%7Cr*%7Cs*%7Ct*%7Cu*%7Cv*%7Cw*%7Cx*%7Cy*%7Cz*%7C1*%7C2*%7C3*%7C4*%7C5*%7C6*%7C7*%7C8*%7C9*%7C0*%7C%28*%7C%29*%7C_*%29&t=a&o=&pp=250&p=',pageNo)
cat(paste0('Query: ', 'HEPSÄ°', ' Page:No ', pageNo, '/', numPages,' @', Sys.time()))
# Download the page
sourceCode <- getURL(pageURL)
print(paste0('Download complete.', ' @', Sys.time()))
pattern <- 'Showing <strong>\\d* results<\\/strong> over (\\d*) pages'
numPages <- as.numeric(str_match(sourceCode, pattern)[,-1])
if(is.na(numPages)){
print('numPages NA')
break
}
# Extract the submissions from (trimmed) source code
startStop <- str_locate(sourceCode, c('<tr class','</table>'))
sourceCode <- str_sub(sourceCode, startStop[1,1], startStop[2,2])
submissions <- getSubmissions(sourceCode)
query <- paste('SELECT MAX(submissionId) FROM submissions')
# paste(submissions[, "submissionId"], collapse = ','),
maxDB <- dbGetQuery(conn=con, statement=query)
cat(paste0('Last submitId is:', maxDB))
submissions <- submissions[submissions[,'submissionId'] > maxDB,]
print(paste0('There are ', nrow(submissions), ' new submissions in page ', pageNo))
pageNo <- pageNo + 1
if(nrow(submissions) < 1) {
break
}
# Encoding sometimes gives errors
Encoding(submissions) <- "unknown"
submissions <- enc2utf8(submissions)
Encoding(submissions) <- "unknown"
dbWriteTable(conn=con, name="submissions", value=as.data.frame(submissions), append=TRUE, row.names=FALSE)
if(pageNo > numPages){
break;
}
}
lapply( dbListConnections( dbDriver( drv = "MySQL")), dbDisconnect)
a=rbind(c(1,2),c(3,4))
View(a)
colnames(a) <- c('a', 'b')
a['a'<=1,]
a
a['a'==1,]
a['a'>1,]
a[,'a'>1]
a[a[,'a'>1],]
a[a>1,]
a > 1
a[a > 1,'a']
a[(a > 1)['a'],]
(a > 1)['a']
(a > 1)
(a > 1)[,'a']
(a > 1)[,'b']
a['a' > 1]
a['a' > 1,]
a[a > 1,]
a[a[,'a']> 1]
# paste(submissions[, "submissionId"], collapse = ','),
maxDB <- as.integer(dbGetQuery(conn=con, statement=query))
setwd("C:\\Users\\User.DESKTOP-KRQQ533\\Desktop\\GradCafe\\")
require(RMySQL)
require(data.table)
require(RCurl)
require(stringr)
source("getSubmissions.R")
#chars <- c('a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v',
#           'w','x','y','z','1','2','3','4','5','6','7','8','9','0')
con <- dbConnect(RMySQL::MySQL(), dbname = "mydb", user="rUpdater", password="rUpdate")
numPages = -1
#pageURL <- "http://thegradcafe.com/survey/index.php"
pageNo = 1
repeat {
# Construct the new page URL and log it
#pageURL <- paste0("http://thegradcafe.com/survey/index.php?q=", oneChar, "*&p=", pageNo, "&pp=250")
pageURL <- paste0('http://thegradcafe.com/survey/index.php?q=%28a*%7Cb*%7Cc*%7Cd*%7Ce*%7Cf*%7Cg*%7Ch*%7Ci*%7Cj*%7Ck*%7Cl*%7Cm*%7Cn*%7Co*%7Cp*%7Cq*%7Cr*%7Cs*%7Ct*%7Cu*%7Cv*%7Cw*%7Cx*%7Cy*%7Cz*%7C1*%7C2*%7C3*%7C4*%7C5*%7C6*%7C7*%7C8*%7C9*%7C0*%7C%28*%7C%29*%7C_*%29&t=a&o=&pp=250&p=',pageNo)
cat(paste0('Query: ', 'HEPSÄ°', ' Page:No ', pageNo, '/', numPages,' @', Sys.time()))
# Download the page
sourceCode <- getURL(pageURL)
print(paste0('Download complete.', ' @', Sys.time()))
pattern <- 'Showing <strong>\\d* results<\\/strong> over (\\d*) pages'
numPages <- as.numeric(str_match(sourceCode, pattern)[,-1])
if(is.na(numPages)){
print('numPages NA')
break
}
# Extract the submissions from (trimmed) source code
startStop <- str_locate(sourceCode, c('<tr class','</table>'))
sourceCode <- str_sub(sourceCode, startStop[1,1], startStop[2,2])
submissions <- getSubmissions(sourceCode)
query <- paste('SELECT MAX(submissionId) FROM submissions')
# paste(submissions[, "submissionId"], collapse = ','),
maxDB <- as.integer(dbGetQuery(conn=con, statement=query))
cat(paste0('Last submitId is:', maxDB))
submissions <- submissions[submissions[,'submissionId'] > maxDB,]
print(paste0('There are ', nrow(submissions), ' new submissions in page ', pageNo))
pageNo <- pageNo + 1
if(nrow(submissions) < 1) {
break
}
# Encoding sometimes gives errors
Encoding(submissions) <- "unknown"
submissions <- enc2utf8(submissions)
Encoding(submissions) <- "unknown"
dbWriteTable(conn=con, name="submissions", value=as.data.frame(submissions), append=TRUE, row.names=FALSE)
if(pageNo > numPages){
break;
}
}
lapply( dbListConnections( dbDriver( drv = "MySQL")), dbDisconnect)
setwd("C:\\Users\\User.DESKTOP-KRQQ533\\Desktop\\GradCafe\\")
require(RMySQL)
require(data.table)
require(RCurl)
require(stringr)
source("getSubmissions.R")
#chars <- c('a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v',
#           'w','x','y','z','1','2','3','4','5','6','7','8','9','0')
con <- dbConnect(RMySQL::MySQL(), dbname = "mydb", user="rUpdater", password="rUpdate")
numPages = -1
#pageURL <- "http://thegradcafe.com/survey/index.php"
pageNo = 1
repeat {
# Construct the new page URL and log it
#pageURL <- paste0("http://thegradcafe.com/survey/index.php?q=", oneChar, "*&p=", pageNo, "&pp=250")
pageURL <- paste0('http://thegradcafe.com/survey/index.php?q=%28a*%7Cb*%7Cc*%7Cd*%7Ce*%7Cf*%7Cg*%7Ch*%7Ci*%7Cj*%7Ck*%7Cl*%7Cm*%7Cn*%7Co*%7Cp*%7Cq*%7Cr*%7Cs*%7Ct*%7Cu*%7Cv*%7Cw*%7Cx*%7Cy*%7Cz*%7C1*%7C2*%7C3*%7C4*%7C5*%7C6*%7C7*%7C8*%7C9*%7C0*%7C%28*%7C%29*%7C_*%29&t=a&o=&pp=250&p=',pageNo)
cat(paste0('Query: ', 'HEPSÄ°', ' Page:No ', pageNo, '/', numPages,' @', Sys.time()))
# Download the page
sourceCode <- getURL(pageURL)
print(paste0('Download complete.', ' @', Sys.time()))
pattern <- 'Showing <strong>\\d* results<\\/strong> over (\\d*) pages'
numPages <- as.numeric(str_match(sourceCode, pattern)[,-1])
if(is.na(numPages)){
print('numPages NA')
break
}
# Extract the submissions from (trimmed) source code
startStop <- str_locate(sourceCode, c('<tr class','</table>'))
sourceCode <- str_sub(sourceCode, startStop[1,1], startStop[2,2])
submissions <- getSubmissions(sourceCode)
query <- paste('SELECT MAX(submissionId) FROM submissions')
# paste(submissions[, "submissionId"], collapse = ','),
maxDB <- as.integer(dbGetQuery(conn=con, statement=query))
cat(paste0('Last submitId is:', maxDB))
unfilteredNrow <- nrow(submissions)
submissions <- submissions[submissions[,'submissionId'] > maxDB,]
print(paste0('There are ', nrow(submissions), ' new submissions in page ', pageNo))
pageNo <- pageNo + 1
if(nrow(submissions) < 1 || nrow(submissions) < unfilteredNrow) {
break
}
# Encoding sometimes gives errors
Encoding(submissions) <- "unknown"
submissions <- enc2utf8(submissions)
Encoding(submissions) <- "unknown"
dbWriteTable(conn=con, name="submissions", value=as.data.frame(submissions), append=TRUE, row.names=FALSE)
if(pageNo > numPages){
break;
}
}
lapply( dbListConnections( dbDriver( drv = "MySQL")), dbDisconnect)
setwd("C:\\Users\\User.DESKTOP-KRQQ533\\Desktop\\GradCafe\\")
require(RMySQL)
require(data.table)
require(RCurl)
require(stringr)
source("getSubmissions.R")
#chars <- c('a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v',
#           'w','x','y','z','1','2','3','4','5','6','7','8','9','0')
con <- dbConnect(RMySQL::MySQL(), dbname = "mydb", user="rUpdater", password="rUpdate")
numPages = -1
#pageURL <- "http://thegradcafe.com/survey/index.php"
pageNo = 1
repeat {
# Construct the new page URL and log it
#pageURL <- paste0("http://thegradcafe.com/survey/index.php?q=", oneChar, "*&p=", pageNo, "&pp=250")
pageURL <- paste0('http://thegradcafe.com/survey/index.php?q=%28a*%7Cb*%7Cc*%7Cd*%7Ce*%7Cf*%7Cg*%7Ch*%7Ci*%7Cj*%7Ck*%7Cl*%7Cm*%7Cn*%7Co*%7Cp*%7Cq*%7Cr*%7Cs*%7Ct*%7Cu*%7Cv*%7Cw*%7Cx*%7Cy*%7Cz*%7C1*%7C2*%7C3*%7C4*%7C5*%7C6*%7C7*%7C8*%7C9*%7C0*%7C%28*%7C%29*%7C_*%29&t=a&o=&pp=250&p=',pageNo)
cat(paste0('Query: ', 'HEPSÄ°', ' Page:No ', pageNo, '/', numPages,' @', Sys.time()))
# Download the page
sourceCode <- getURL(pageURL)
print(paste0('Download complete.', ' @', Sys.time()))
pattern <- 'Showing <strong>\\d* results<\\/strong> over (\\d*) pages'
numPages <- as.numeric(str_match(sourceCode, pattern)[,-1])
if(is.na(numPages)){
print('numPages NA')
break
}
# Extract the submissions from (trimmed) source code
startStop <- str_locate(sourceCode, c('<tr class','</table>'))
sourceCode <- str_sub(sourceCode, startStop[1,1], startStop[2,2])
submissions <- getSubmissions(sourceCode)
query <- paste('SELECT MAX(submissionId) FROM submissions')
# paste(submissions[, "submissionId"], collapse = ','),
maxDB <- as.integer(dbGetQuery(conn=con, statement=query))
cat(paste0('Last submitId is:', maxDB))
unfilteredNrow <- nrow(submissions)
submissions <- submissions[submissions[,'submissionId'] > maxDB,]
print(paste0('There are ', nrow(submissions), ' new submissions in page ', pageNo))
pageNo <- pageNo + 1
if(nrow(submissions) < 1 || nrow(submissions) < unfilteredNrow) {
break
}
# Encoding sometimes gives errors
Encoding(submissions) <- "unknown"
submissions <- enc2utf8(submissions)
Encoding(submissions) <- "unknown"
dbWriteTable(conn=con, name="submissions", value=as.data.frame(submissions), append=TRUE, row.names=FALSE)
if(pageNo > numPages){
break;
}
}
lapply( dbListConnections( dbDriver( drv = "MySQL")), dbDisconnect)
setwd("C:\\Users\\User.DESKTOP-KRQQ533\\Desktop\\GradCafe\\")
require(RMySQL)
require(data.table)
require(RCurl)
require(stringr)
source("getSubmissions.R")
#chars <- c('a','b','c','d','e','f','g','h','i','j','k','l','m','n','o','p','q','r','s','t','u','v',
#           'w','x','y','z','1','2','3','4','5','6','7','8','9','0')
con <- dbConnect(RMySQL::MySQL(), dbname = "mydb", user="rUpdater", password="rUpdate")
numPages = -1
#pageURL <- "http://thegradcafe.com/survey/index.php"
pageNo = 1
repeat {
# Construct the new page URL and log it
#pageURL <- paste0("http://thegradcafe.com/survey/index.php?q=", oneChar, "*&p=", pageNo, "&pp=250")
pageURL <- paste0('http://thegradcafe.com/survey/index.php?q=%28a*%7Cb*%7Cc*%7Cd*%7Ce*%7Cf*%7Cg*%7Ch*%7Ci*%7Cj*%7Ck*%7Cl*%7Cm*%7Cn*%7Co*%7Cp*%7Cq*%7Cr*%7Cs*%7Ct*%7Cu*%7Cv*%7Cw*%7Cx*%7Cy*%7Cz*%7C1*%7C2*%7C3*%7C4*%7C5*%7C6*%7C7*%7C8*%7C9*%7C0*%7C%28*%7C%29*%7C_*%29&t=a&o=&pp=250&p=',pageNo)
cat(paste0('Query: ', 'HEPSÄ°', ' Page:No ', pageNo, '/', numPages,' @', Sys.time()))
# Download the page
sourceCode <- getURL(pageURL)
print(paste0('Download complete.', ' @', Sys.time()))
pattern <- 'Showing <strong>\\d* results<\\/strong> over (\\d*) pages'
numPages <- as.numeric(str_match(sourceCode, pattern)[,-1])
if(is.na(numPages)){
print('numPages NA')
break
}
# Extract the submissions from (trimmed) source code
startStop <- str_locate(sourceCode, c('<tr class','</table>'))
sourceCode <- str_sub(sourceCode, startStop[1,1], startStop[2,2])
submissions <- getSubmissions(sourceCode)
query <- paste('SELECT MAX(submissionId) FROM submissions')
# paste(submissions[, "submissionId"], collapse = ','),
maxDB <- as.integer(dbGetQuery(conn=con, statement=query))
cat(paste0('Last submitId is:', maxDB))
unfilteredNrow <- nrow(submissions)
submissions <- submissions[submissions[,'submissionId'] > maxDB,]
print(paste0('There are ', nrow(submissions), ' new submissions in page ', pageNo))
pageNo <- pageNo + 1
if(nrow(submissions) < 1 || nrow(submissions) < unfilteredNrow) {
break
}
# Encoding sometimes gives errors
Encoding(submissions) <- "unknown"
submissions <- enc2utf8(submissions)
Encoding(submissions) <- "unknown"
dbWriteTable(conn=con, name="submissions", value=as.data.frame(submissions), append=TRUE, row.names=FALSE)
if(pageNo > numPages){
break;
}
}
lapply( dbListConnections( dbDriver( drv = "MySQL")), dbDisconnect)
